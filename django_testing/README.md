## Домашнее задание к лекции 5. «Тестирование Django-приложений с использованием Pytest»

### Неронов Алексей группа <span style="color:green">**FPY-120**</span>


## Описание

Есть бэкенд простого приложения с курсами и списком студентов, вся логика для бэкенда уже есть в заготовке.

## Задача

Необходимо написать тесты для текущей логики приложения.

Завести фикстуры:

- для api-client,
- для фабрики курсов,
- для фабрики студентов.

В качестве библиотеки для фабрик использовать `model_bakery` (https://github.com/model-bakers/model_bakery).

Добавить следующие тест-кейсы:

- проверка получения первого курса (retrieve-логика):
  - создать курс через фабрику;
  - построить URL и сделать запрос через тестовый клиент;
  - проверить, что вернулся именно тот курс, который запрошен;
- проверка получения списка курсов (list-логика):
  - аналогично — сначала вызывать фабрики, затем сделать запрос и проверить результат;
- проверка фильтрации списка курсов по `id`:
  - создать курсы через фабрику, передать ID одного курса в фильтр, проверить результат запроса с фильтром;
- проверка фильтрации списка курсов по `name`;
- тест успешного создания курса:
  - здесь фабрика не нужна, подготовить JSON-данные и создать курс;
- тест успешного обновления курса:
  - сначала через фабрику создать, потом обновить JSON-данными;
- тест успешного удаления курса.

Все тесты должны явно проверять код возврата.

Использовать декоратор `@pytest.mark.django_db`, чтобы тесты использовали базу.

## Дополнительные задания (необязательные для выполнения)

### Ограничить число студентов на курсе

Добавить валидацию на максимальное число студентов на курсе — 20.
Придумать, как протестировать это ограничение, не создавая 20 сущностей в базе данных.

**Подсказка:** задать максимальное число студентов в `settings.py`: `MAX_STUDENTS_PER_COURSE`.
В тестах использовать `parametrize` и фикстуру `settings` (https://pytest-django.readthedocs.io/en/latest/helpers.html#settings),
чтобы переопределить параметр.

Протестировать как неудачный исход, так и успешный.

## Документация

pytest: https://docs.pytest.org/en/stable/

pytest-django: https://pytest-django.readthedocs.io/en/latest/

тестирование DRF: https://www.django-rest-framework.org/api-guide/testing/

## Документация по проекту

Для запуска проекта необходимо:

Перед началом работы убедиться, что все зависимости установлены (dev-зависимости указаны в `requirements-dev.txt`).

Установить зависимости:

```bash
pip install -r requirements-dev.txt
```

Необходимо создать базу в postgres и прогнать миграции:

```base
manage.py migrate
```

Запуск тестов делается через команду:

```
$ pytest
```